# Étape de construction
FROM node:16 AS build

# Définir les variables d'environnement via ARG
ARG REACT_APP_API_URL
ARG REACT_APP_PROJECT_ID

# Définir le répertoire de travail et copier les fichiers
WORKDIR /app
COPY . .

# Utiliser envsubst pour générer config.js à partir de config.js.template
RUN apt-get update && apt-get install -y gettext-base \
    && envsubst < ./front-end/config.js.template > ./front-end/src/config.js

# Installer les dépendances
RUN npm install

# Construire l'application
RUN npm run build

# Étape de production
FROM nginx:alpine

# Copier les fichiers construits de l'étape précédente
COPY --from=build /app/front-end/build /usr/share/nginx/html

# Exposer le port
EXPOSE 80
